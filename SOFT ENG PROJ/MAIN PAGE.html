<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>MAPúa Navigation System</title>
    <link rel="shortcut icon" type="image/png" href="assets/MAPúa-logo.png">
    
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      .background-decoration {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
      }

      .background-decoration::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(220,220,220,0.3) 0%, transparent 70%);
        animation: float 8s ease-in-out infinite;
      }

      .background-decoration::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -30%;
        width: 60%;
        height: 60%;
        background: radial-gradient(circle, rgba(179,0,0,0.05) 0%, transparent 70%);
        animation: float 12s ease-in-out infinite reverse;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
      }

      .container {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: linear-gradient(135deg, #B30000 0%, #8B0000 100%);
        padding: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: shimmer 6s ease-in-out infinite;
      }

      @keyframes shimmer {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(180deg); }
      }

      .header-content {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        margin: 0 auto;
      }

      .logo {
        width: 64px;
        height: 64px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        backdrop-filter: blur(10px);
      }

      .logo i {
        font-size: 32px;
        color: white;
      }

      .title {
        color: white;
        font-size: 3rem;
        font-weight: 700;
        margin: 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .nav-links {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1.5rem;
      }

      .nav-links a {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.1);
      }

      .nav-links a:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      .main-content {
        flex: 1;
        padding: 3rem 2rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .description {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 3rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(220, 220, 220, 0.5);
        text-align: center;
      }

      .description p {
        color: #495057;
        font-size: 1.1rem;
        line-height: 1.6;
        margin: 0;
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(220, 220, 220, 0.5);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        animation: fadeInUp 0.6s ease forwards;
        opacity: 0;
        transform: translateY(30px);
      }

      .section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #B30000, #FF4444);
      }

      .section:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
      }

      .section:nth-child(1) { animation-delay: 0.1s; }
      .section:nth-child(2) { animation-delay: 0.2s; }
      .section:nth-child(3) { animation-delay: 0.3s; }
      .section:nth-child(4) { animation-delay: 0.4s; }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #B30000;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .section-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: white;
        background: linear-gradient(135deg, #B30000, #8B0000);
      }

      .canvas-container {
        margin-bottom: 2rem;
        text-align: center;
      }

      #canvas {
        border: 2px solid #e9ecef;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        max-width: 100%;
        height: auto;
      }

      .control-group {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        gap: 1rem;
      }

      .control-label {
        min-width: 140px;
        font-weight: 600;
        color: #495057;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .location-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: white;
        flex-shrink: 0;
      }

      .from-icon {
        background: linear-gradient(135deg, #4CAF50, #45a049);
      }

      .to-icon {
        background: linear-gradient(135deg, #2196F3, #1976D2);
      }

      .control-input {
        flex: 1;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 16px;
        padding: 1rem 1.25rem;
        font-size: 1rem;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
      }

      .control-input:hover {
        background: #e9ecef;
        border-color: #B30000;
        transform: translateY(-1px);
      }

      .control-input:focus {
        outline: none;
        border-color: #B30000;
        box-shadow: 0 0 0 4px rgba(179, 0, 0, 0.1);
        background: white;
      }

      .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      .btn {
        flex: 1;
        padding: 1rem 1.5rem;
        border: none;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transition: all 0.4s ease;
        transform: translate(-50%, -50%);
      }

      .btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .btn:active {
        transform: scale(0.98);
      }

      .btn-primary {
        background: linear-gradient(135deg, #B30000, #8B0000);
        color: white;
        box-shadow: 0 4px 15px rgba(179, 0, 0, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(179, 0, 0, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #6c757d, #5a6268);
        color: white;
        box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
      }

      .image-container {
        text-align: center;
        margin-top: 1rem;
      }

      #displayedImage {
        max-width: 100%;
        height: auto;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      #displayedImage:hover {
        transform: scale(1.02);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
      }

      .bookmark-list {
        margin-top: 1.5rem;
      }

      .bookmark-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
      }

      .bookmark-item:hover {
        background: #e9ecef;
        transform: translateX(4px);
      }

      .bookmark-info {
        flex: 1;
      }

      .bookmark-name {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.25rem;
      }

      .bookmark-route {
        font-size: 0.875rem;
        color: #6c757d;
      }

      .bookmark-actions {
        display: flex;
        gap: 0.5rem;
      }

      .btn-small {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        border-radius: 8px;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: #6c757d;
        font-size: 1.1rem;
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background: white;
        margin: 5% auto;
        padding: 2rem;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: modalFadeIn 0.3s ease;
      }

      @keyframes modalFadeIn {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e9ecef;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #B30000;
      }

      .close {
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: #6c757d;
        transition: color 0.3s ease;
      }

      .close:hover {
        color: #B30000;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #495057;
      }

      .form-input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        font-size: 1rem;
        color: #495057;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
      }

      .form-input:focus {
        outline: none;
        border-color: #B30000;
        box-shadow: 0 0 0 4px rgba(179, 0, 0, 0.1);
      }

      .modal-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .header {
          padding: 1.5rem 1rem;
        }
        
        .title {
          font-size: 2.5rem;
        }
        
        .logo {
          width: 56px;
          height: 56px;
        }
        
        .logo i {
          font-size: 24px;
        }
        
        .main-content {
          padding: 2rem 1rem;
        }
        
        .section {
          padding: 1.5rem;
        }
        
        .control-group {
          flex-direction: column;
          align-items: stretch;
          gap: 0.5rem;
        }
        
        .control-label {
          min-width: auto;
          margin-bottom: 0.5rem;
        }
        
        .button-group {
          flex-direction: column;
        }
        
        .nav-links {
          flex-direction: column;
          gap: 0.5rem;
        }

        #canvas {
          width: 100%;
          max-width: 100%;
        }
      }

      /* Tablet Responsive */
      @media (min-width: 769px) and (max-width: 1024px) {
        .main-content {
          padding: 2.5rem 2rem;
        }
      }

      /* Large Desktop */
      @media (min-width: 1400px) {
        .main-content {
          max-width: 1400px;
        }
        
        .header-content {
          max-width: 1400px;
        }
      }

      /* Notification styles */
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    </style>
</head>
<body>
    <div class="background-decoration"></div>
    
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-map-marked-alt"></i>
                </div>
                <h1 class="title">MAPúa Navigation</h1>
                <div class="nav-links">
                    <a href="#bookmarks" onclick="scrollToSection('bookmark-section')">
                        <i class="fas fa-bookmark"></i> Bookmarks
                    </a>
                    <a href="#" onclick="showCurrentTime()">
                        <i class="fas fa-clock"></i> Time
                    </a>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Description -->
            <div class="description">
                <p>
                    Welcome to the MAPúa Navigation System. This integrated platform allows you to find the shortest path between locations, 
                    view location images, and manage your bookmarked routes. Select your starting and destination points to get detailed 
                    directions and visual guidance throughout the campus.
                </p>
            </div>

            <!-- Campus Map Section -->
            <div class="section" id="map-section">
                <h3 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-map"></i>
                    </div>
                    Campus Map & Pathfinding
                </h3>
                <div class="canvas-container">
                    <canvas width="1445" height="719" id="canvas"></canvas>
                </div>
            </div>
            
            <!-- Route Planning Section -->
            <div class="section" id="route-section">
                <h3 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-route"></i>
                    </div>
                    Route Planning
                </h3>
                
                <div class="control-group">
                    <label class="control-label">
                        <div class="location-icon from-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        From Location:
                    </label>
                    <select id="initial" class="control-input" onchange="updateImageFromPathfinding()">
                        <option value="">Select starting point</option>
                        <option value="elevator">Elevator</option>
                        <option value="fire-exit-elevator">Fire Exit Elevator</option>
                        <option value="canteen">Canteen</option>
                        <option value="Student lounge 1">Student Lounge 1</option>
                        <option value="hallway">Hallway</option>
                        <option value="clinic">Clinic</option>
                        <option value="orientation room">Orientation Room</option>
                        <option value="counsellor">Counsellor</option>
                        <option value="multi-purpose">Multi-purpose</option>
                        <option value="tech serve">Tech Serve</option>
                        <option value="student council">Student Council</option>
                        <option value="SOCIP">SOCIP</option>
                        <option value="Registrar">Registrar</option>
                        <option value="admission">Admission</option>
                        <option value="treasury">Treasury</option>
                        <option value="student lounge 2">Student Lounge 2</option>
                        <option value="fire exit 2">Fire Exit 2</option>
                        <option value="lobby area">Lobby Area</option>
                        <option value="bookstore">Bookstore</option>
                        <option value="1">Room 1</option>
                        <option value="2">Room 2</option>
                        <option value="3">Room 3</option>
                        <option value="4">Room 4</option>
                        <option value="5">Room 5</option>
                        <option value="6">Room 6</option>
                        <option value="7">Room 7</option>
                        <option value="8">Room 8</option>
                        <option value="9">Room 9</option>
                        <option value="10">Room 10</option>
                        <option value="11">Room 11</option>
                        <option value="12">Room 12</option>
                        <option value="13">Room 13</option>
                        <option value="14">Room 14</option>
                        <option value="15">Room 15</option>
                        <option value="16">Room 16</option>
                        <option value="17">Room 17</option>
                        <option value="18">Room 18</option>
                        <option value="19">Room 19</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        <div class="location-icon to-icon">
                            <i class="fas fa-flag-checkered"></i>
                        </div>
                        To Location:
                    </label>
                    <select id="final" class="control-input" onchange="updateImageFromPathfinding()">
                        <option value="">Select destination</option>
                        <option value="elevator">Elevator</option>
                        <option value="fire-exit-elevator">Fire Exit Elevator</option>
                        <option value="canteen">Canteen</option>
                        <option value="Student lounge 1">Student Lounge 1</option>
                        <option value="hallway">Hallway</option>
                        <option value="clinic">Clinic</option>
                        <option value="orientation room">Orientation Room</option>
                        <option value="counsellor">Counsellor</option>
                        <option value="multi-purpose">Multi-purpose</option>
                        <option value="tech serve">Tech Serve</option>
                        <option value="student council">Student Council</option>
                        <option value="SOCIP">SOCIP</option>
                        <option value="Registrar">Registrar</option>
                        <option value="admission">Admission</option>
                        <option value="treasury">Treasury</option>
                        <option value="student lounge 2">Student Lounge 2</option>
                        <option value="fire exit 2">Fire Exit 2</option>
                        <option value="lobby area">Lobby Area</option>
                        <option value="bookstore">Bookstore</option>
                        <option value="1">Room 1</option>
                        <option value="2">Room 2</option>
                        <option value="3">Room 3</option>
                        <option value="4">Room 4</option>
                        <option value="5">Room 5</option>
                        <option value="6">Room 6</option>
                        <option value="7">Room 7</option>
                        <option value="8">Room 8</option>
                        <option value="9">Room 9</option>
                        <option value="10">Room 10</option>
                        <option value="11">Room 11</option>
                        <option value="12">Room 12</option>
                        <option value="13">Room 13</option>
                        <option value="14">Room 14</option>
                        <option value="15">Room 15</option>
                        <option value="16">Room 16</option>
                        <option value="17">Room 17</option>
                        <option value="18">Room 18</option>
                        <option value="19">Room 19</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="findShortestPath()">
                        <i class="fas fa-route"></i>
                        <span>Find Route</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearPath()">
                        <i class="fas fa-eraser"></i>
                        <span>Clear Path</span>
                    </button>
                </div>
            </div>

            <!-- Location View Section -->
            <div class="section" id="image-section">
                <h3 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    Location View
                </h3>
                
                <div class="control-group">
                    <label class="control-label">
                        <div class="location-icon from-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        Current View:
                    </label>
                    <select id="initialLocation" class="control-input" onchange="updateLocationView()">
                        <option value="">Select location</option>
                        <option value="lobby">Lobby</option>
                        <option value="canteen">Canteen</option>
                        <option value="library">Library</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        <div class="location-icon to-icon">
                            <i class="fas fa-map-pin"></i>
                        </div>
                        Destination View:
                    </label>
                    <select id="desiredLocation" class="control-input" onchange="updateLocationView()">
                        <option value="">Select destination</option>
                        <option value="lobby">Lobby</option>
                        <option value="canteen">Canteen</option>
                        <option value="library">Library</option>
                    </select>
                </div>
                
                <div class="image-container">
                    <img id="displayedImage" src="image/lobby.jpg" alt="Location Image" style="display: none;">
                </div>
            </div>

            <!-- Bookmark Section -->
            <div class="section" id="bookmark-section">
                <h3 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-bookmark"></i>
                    </div>
                    Saved Routes
                </h3>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="bookmarkCurrentRoute()">
                        <i class="fas fa-plus"></i>
                        <span>Bookmark Current Route</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearAllBookmarks()">
                        <i class="fas fa-trash"></i>
                        <span>Clear All</span>
                    </button>
                </div>
                
                <div class="bookmark-list" id="bookmarkList">
                    <div class="empty-state">
                        <i class="fas fa-bookmark"></i>
                        <p>No bookmarked routes yet. Plan a route and bookmark it!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bookmark Name Modal -->
    <div id="bookmarkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Save Route</h2>
                <button class="close" onclick="closeBookmarkModal()">&times;</button>
            </div>
            <form id="bookmarkForm">
                <div class="form-group">
                    <label class="form-label">Route Name</label>
                    <input type="text" class="form-input" id="routeName" placeholder="Enter a name for this route" required>
                </div>
                <div class="form-group">
                    <label class="form-label">From</label>
                    <input type="text" class="form-input" id="routeFrom" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">To</label>
                    <input type="text" class="form-input" id="routeTo" readonly>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        <span>Save Bookmark</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeBookmarkModal()">
                        <i class="fas fa-times"></i>
                        <span>Cancel</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let bookmarkedRoutes = [];
        let currentPath = null;

        // Initialize on page load
        window.addEventListener('load', function() {
            setLocationsFromURL();
            loadBookmarks();
            initializeCanvas();
        });

        // URL parameter handling
        function setLocationsFromURL() {
            var urlParams = new URLSearchParams(window.location.search);
            var initialLocation = urlParams.get('initial');
            var desiredLocation = urlParams.get('desired');

            if (initialLocation && desiredLocation) {
                document.getElementById('initialLocation').value = initialLocation;
                document.getElementById('desiredLocation').value = desiredLocation;
                updateLocationView();
            }
        }

        // Image handling functions
        function updateLocationView() {
            var initialLocation = document.getElementById('initialLocation').value;
            var desiredLocation = document.getElementById('desiredLocation').value;

            var imageSource = getImageSource(initialLocation, desiredLocation);
            var imgElement = document.getElementById('displayedImage');
            
            if (imageSource && (initialLocation || desiredLocation)) {
                imgElement.src = imageSource;
                imgElement.style.display = 'block';
            } else {
                imgElement.style.display = 'none';
            }
        }

        function getImageSource(initialLocation, desiredLocation) {
            var locationImages = {
                "lobby": "image/lobby.jpg",
                "canteen": "image/canteen.jpg",
                "library": "image/image1.jpg",
                "lobby area": "image/lobby.jpg"
            };

            return locationImages[desiredLocation] || locationImages[initialLocation] || null;
        }

        // Update image based on pathfinding selections
        function updateImageFromPathfinding() {
            var initial = document.getElementById('initial').value;
            var final = document.getElementById('final').value;
            
            // Map pathfinding locations to image locations
            var locationMapping = {
                "lobby area": "lobby",
                "canteen": "canteen"
            };
            
            var mappedInitial = locationMapping[initial] || initial;
            var mappedFinal = locationMapping[final] || final;
            
            // Update image selectors
            document.getElementById('initialLocation').value = mappedInitial || '';
            document.getElementById('desiredLocation').value = mappedFinal || '';
            
            updateLocationView();
        }

        // Pathfinding functions
        function findShortestPath() {
            var initial = document.getElementById('initial').value;
            var final = document.getElementById('final').value;
            
            if (!initial || !final) {
                showNotification('Please select both starting point and destination.', 'warning');
                return;
            }
            
            if (initial === final) {
                showNotification('Starting point and destination cannot be the same.', 'warning');
                return;
            }
            
            // Store current path for bookmarking
            currentPath = { from: initial, to: final };
            
            // This would call your actual pathfinding algorithm
            console.log('Finding path from', initial, 'to', final);
            
            // Placeholder for actual pathfinding implementation
            showNotification('Route calculated from ' + initial + ' to ' + final, 'success');
            
            // You would replace this section with your actual map.js functionality
            drawPath(initial, final);
        }

        function clearPath() {
            // Clear the canvas and reset selections
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            initializeCanvas();
            
            currentPath = null;
            
            // Reset form selections
            document.getElementById('initial').value = '';
            document.getElementById('final').value = '';
            document.getElementById('initialLocation').value = '';
            document.getElementById('desiredLocation').value = '';
            
            updateLocationView();
            showNotification('Path cleared', 'info');
        }

        function initializeCanvas() {
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            
            // Placeholder for map initialization
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw a simple campus layout placeholder
            ctx.strokeStyle = '#B30000';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            
            // Draw building outlines
            ctx.strokeRect(100, 100, 200, 150);
            ctx.strokeRect(400, 150, 180, 120);
            ctx.strokeRect(650, 200, 160, 100);
            ctx.strokeRect(200, 350, 220, 140);
            ctx.strokeRect(500, 400, 200, 130);
            
            // Labels
            ctx.fillStyle = '#495057';
            ctx.font = '16px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Main Building', 200, 180);
            ctx.fillText('Library', 490, 215);
            ctx.fillText('Canteen', 730, 255);
            ctx.fillText('Labs', 310, 425);
            ctx.fillText('Admin', 600, 470);
            
            // Draw paths
            ctx.strokeStyle = '#6c757d';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            ctx.moveTo(300, 175);
            ctx.lineTo(400, 210);
            ctx.moveTo(580, 210);
            ctx.lineTo(650, 250);
            ctx.moveTo(200, 250);
            ctx.lineTo(200, 350);
            ctx.moveTo(420, 350);
            ctx.lineTo(500, 465);
            ctx.stroke();
        }

        function drawPath(from, to) {
            // Placeholder function to draw path between locations
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            
            // This would be replaced with actual coordinates from your map data
            var locations = {
                'canteen': {x: 730, y: 250},
                'library': {x: 490, y: 210},
                'lobby area': {x: 200, y: 175},
                'elevator': {x: 150, y: 175},
                'clinic': {x: 310, y: 420}
            };
            
            var startPoint = locations[from] || {x: 100, y: 100};
            var endPoint = locations[to] || {x: 800, y: 500};
            
            // Draw path
            ctx.strokeStyle = '#B30000';
            ctx.lineWidth = 4;
            ctx.setLineDash([]);
            
            ctx.beginPath();
            ctx.moveTo(startPoint.x, startPoint.y);
            ctx.lineTo(endPoint.x, endPoint.y);
            ctx.stroke();
            
            // Draw markers
            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.arc(startPoint.x, startPoint.y, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#2196F3';
            ctx.beginPath();
            ctx.arc(endPoint.x, endPoint.y, 8, 0, 2 * Math.PI);
            ctx.fill();
        }

        // Bookmark functions
        function bookmarkCurrentRoute() {
            if (!currentPath) {
                showNotification('Please calculate a route first before bookmarking.', 'warning');
                return;
            }
            
            // Pre-fill the modal form
            document.getElementById('routeFrom').value = currentPath.from;
            document.getElementById('routeTo').value = currentPath.to;
            document.getElementById('routeName').value = currentPath.from + ' to ' + currentPath.to;
            
            // Show modal
            document.getElementById('bookmarkModal').style.display = 'block';
            document.getElementById('routeName').focus();
        }

        function closeBookmarkModal() {
            document.getElementById('bookmarkModal').style.display = 'none';
            document.getElementById('bookmarkForm').reset();
        }

        function saveBookmark() {
            var routeName = document.getElementById('routeName').value.trim();
            
            if (!routeName) {
                showNotification('Please enter a route name.', 'warning');
                return;
            }
            
            var bookmark = {
                id: Date.now(),
                name: routeName,
                from: currentPath.from,
                to: currentPath.to,
                timestamp: new Date().toISOString()
            };
            
            bookmarkedRoutes.push(bookmark);
            saveBookmarksToStorage();
            displayBookmarks();
            closeBookmarkModal();
            showNotification('Route bookmarked successfully!', 'success');
        }

        function displayBookmarks() {
            var bookmarkList = document.getElementById('bookmarkList');
            
            if (bookmarkedRoutes.length === 0) {
                bookmarkList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bookmark"></i>
                        <p>No bookmarked routes yet. Plan a route and bookmark it!</p>
                    </div>
                `;
                return;
            }
            
            var html = '';
            bookmarkedRoutes.forEach(function(bookmark, index) {
                html += `
                    <div class="bookmark-item">
                        <div class="bookmark-info">
                            <div class="bookmark-name">${bookmark.name}</div>
                            <div class="bookmark-route">
                                <i class="fas fa-map-marker-alt" style="color: #4CAF50;"></i> 
                                ${bookmark.from} 
                                <i class="fas fa-arrow-right" style="margin: 0 0.5rem;"></i> 
                                <i class="fas fa-flag-checkered" style="color: #2196F3;"></i> 
                                ${bookmark.to}
                            </div>
                        </div>
                        <div class="bookmark-actions">
                            <button class="btn btn-primary btn-small" onclick="loadBookmarkedRoute(${index})">
                                <i class="fas fa-route"></i> Go
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="deleteBookmark(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            bookmarkList.innerHTML = html;
        }

        function loadBookmarkedRoute(index) {
            var bookmark = bookmarkedRoutes[index];
            document.getElementById('initial').value = bookmark.from;
            document.getElementById('final').value = bookmark.to;
            updateImageFromPathfinding();
            
            // Scroll to route section
            document.getElementById('route-section').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('Route loaded: ' + bookmark.name, 'info');
        }

        function deleteBookmark(index) {
            var bookmark = bookmarkedRoutes[index];
            if (confirm('Are you sure you want to delete "' + bookmark.name + '"?')) {
                bookmarkedRoutes.splice(index, 1);
                saveBookmarksToStorage();
                displayBookmarks();
                showNotification('Bookmark deleted', 'info');
            }
        }

        function clearAllBookmarks() {
            if (bookmarkedRoutes.length === 0) {
                showNotification('No bookmarks to clear', 'info');
                return;
            }
            
            if (confirm('Are you sure you want to delete all bookmarks? This action cannot be undone.')) {
                bookmarkedRoutes = [];
                saveBookmarksToStorage();
                displayBookmarks();
                showNotification('All bookmarks cleared', 'info');
            }
        }

        function saveBookmarksToStorage() {
            // Since localStorage isn't available, we'll keep them in memory for the session
            console.log('Bookmarks saved:', bookmarkedRoutes);
        }

        function loadBookmarks() {
            // Placeholder for loading bookmarks from storage
            console.log('Loading bookmarks...');
            displayBookmarks();
        }

        // Utility functions
        function showCurrentTime() {
            var now = new Date();
            var timeString = now.toLocaleString();
            showNotification('Current time: ' + timeString, 'info');
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const colors = {
                'success': '#4CAF50',
                'warning': '#FF9800',
                'error': '#F44336',
                'info': '#2196F3'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                font-family: 'Inter', sans-serif;
                font-weight: 500;
                backdrop-filter: blur(10px);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Form submission
        document.getElementById('bookmarkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveBookmark();
        });

        // Handle location selector changes
        document.getElementById('initialLocation').addEventListener('change', function() {
            if (this.value) {
                updateLocationView();
            }
        });

        document.getElementById('desiredLocation').addEventListener('change', function() {
            updateLocationView();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('bookmarkModal');
            if (e.target === modal) {
                closeBookmarkModal();
            }
        });

        // Handle canvas responsiveness
        function resizeCanvas() {
            const canvas = document.getElementById('canvas');
            const container = canvas.parentElement;
            const maxWidth = container.clientWidth - 40; // Account for padding
            
            if (canvas.width > maxWidth) {
                const scale = maxWidth / canvas.width;
                canvas.style.width = maxWidth + 'px';
                canvas.style.height = (canvas.height * scale) + 'px';
            }
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('load', resizeCanvas);
    </script>

    <!-- Include your original map.js file -->
    <script src="scripts/map.js"></script>
</body>
</html>